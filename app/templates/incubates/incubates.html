<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Our Incubatees - ATBI</title>
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/agrilogo.png') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/incubates.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/incubates-modal.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- Navigation Bar -->
  <header class="header">
    <div class="header-container">
      <div class="logo">
        <img src="{{ url_for('static', filename='images/agrilogo.png') }}" alt="ATBI logo" class="logo-img">
      </div>
      <nav class="nav-menu">
        <ul class="nav-list">
          <li><a href="{{ url_for('home.index') }}" class="nav-link">HOME</a></li>
          <li><a href="{{ url_for('shop.shop_home') }}" class="nav-link">SHOP</a></li>
          <li><a href="{{ url_for('incubatee_showroom.incubatee_showroom') }}" class="nav-link active">INCUBATEES</a></li>
          <li><a href="{{ url_for('about.about_page')}}" class="nav-link">ABOUT</a></li>
          <li><a href="{{ url_for('contact.contact_page')}}" class="nav-link">CONTACTS</a></li>
          <li><a href="#" id="openCartBtn" class="nav-link cart-btn">üõí<span id="cartCountBadge" class="cart-count-badge">0</span></a></li>
          <!-- Dynamic Login/Logout Button -->
          {% if user_logged_in or admin_logged_in %}
              <li>
                  <a href="{{ url_for('login.logout') }}" class="nav-link logout-btn">
                      LOGOUT
                  </a>
              </li>
          {% else %}
              <li><a href="{{ url_for('login.login') }}" class="nav-link login-btn">LOGIN</a></li>
          {% endif %}
          <li><a href="javascript:void(0)" onclick="openUserDashboard()" class="nav-link dashboard-btn"><i class="fas fa-user"></i> DASHBOARD</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main>
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Our Incubatees</h1>
      <p class="page-subtitle">Discover the innovative Agri-Aqua technology startups and businesses nurtured through our incubation program.</p>
    </div>

    <!-- Dynamic Incubatee Sections -->
    {% for batch_key, incubatees in incubatees_by_batch.items() %}
    <section class="batch" id="{{ batch_key }}">
      <h3>Batch {{ incubatees[0].batch }}</h3>
      <div class="incubates-grid">
        {% for incubatee in incubatees %}
        <div class="incubate-card" onclick="openIncubateeModal({{ incubatee.id }})">
          
          <div class="incubate-image-container">
              <!-- Only show logo if incubatee has a custom logo, otherwise show placeholder -->
              {% if incubatee.logo_url and 'incubatee_logo' in incubatee.logo_url %}
              <img src="{{ url_for('static', filename=incubatee.logo_url) }}" 
                  alt="{{ incubatee.company_name }}" 
                  class="incubate-image">
              {% else %}
              <div class="incubate-image-placeholder">
                <i class="fas fa-building"></i>
                <span>No Logo</span>
              </div>
              {% endif %}
          </div>
          
          <div class="incubate-content">
            <div class="incubate-category">Batch {{ incubatee.batch }}</div>
            <div class="incubate-name">{{ incubatee.company_name }}</div>
            <div class="incubate-description">{{ incubatee.description[:100] }}{% if incubatee.description|length > 100 %}...{% endif %}</div>
            
            <!-- Website Link if available -->
            {% if incubatee.website and incubatee.website != 'No website provided' %}
            <div class="incubate-website">
              <i class="fas fa-globe"></i>
              <a href="{{ incubatee.website }}" target="_blank" onclick="event.stopPropagation();">Visit Website</a>
            </div>
            {% endif %}
            
            <div class="incubate-meta">
              <span class="incubate-year">Since {{ incubatee.year_joined }}</span>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </section>
    {% else %}
    <!-- Empty state if no incubatees -->
    <div class="empty-state">
      <i class="fas fa-seedling"></i>
      <h3>No Incubatees Available</h3>
      <p>There are currently no approved incubatees to display. Check back later for updates.</p>
    </div>
    {% endfor %}

    <!-- Batch 5 - Call for Applications (Static Section) -->
    <section class="batch" id="batch5">
      <h3>Batch 5 - Coming Soon!</h3>
      <div class="call-to-action">
        <div class="cta-content">
          <div class="cta-icon">
            <i class="fas fa-bullhorn"></i>
          </div>
          <h2>Call for Batch 5 Incubatees!</h2>
          <p class="cta-description">
            We're currently accepting applications for Batch 5! If you're a passionate innovator, startup, 
            MSME, student, or researcher with groundbreaking Agri-Aqua technology ideas, this is your chance 
            to join our supportive ecosystem.
          </p>
          <div class="cta-details">
            <div class="cta-detail-item">
              <i class="fas fa-calendar-alt"></i>
              <span><strong>Application Period:</strong> October 10 ‚Äì 24, 2025</span>
            </div>
            <div class="cta-detail-item">
              <i class="fas fa-graduation-cap"></i>
              <span><strong>Open to:</strong> Innovators, Startups, MSMEs, Students, Researchers</span>
            </div>
            <div class="cta-detail-item">
              <i class="fas fa-handshake"></i>
              <span><strong>Benefits:</strong> Mentorship, Funding Access, Collaborative Space</span>
            </div>
          </div>
          <a href="{{ url_for('home.index') }}#apply" class="cta-button">
            Apply Now <i class="fas fa-arrow-right"></i>
          </a>
        </div>
      </div>
    </section>
  </main>

  <!-- Incubatee Details Modal -->
  <div id="incubateeModal" class="modal">
    <div class="modal-content incubatee-modal">
      <span class="close-modal" onclick="closeIncubateeModal()">&times;</span>
      <div id="incubateeModalContent">
        <!-- Content will be loaded dynamically -->
      </div>
    </div>
  </div>

  <footer>
    <p>&copy; 2025 ATBI. All Rights Reserved.</p>
  </footer>

  <!-- Dynamic Floating Batch Navigation -->
  <div class="floating-btn back-home">
    <a href="{{ url_for('home.index') }}" class="back-to-home">‚Üê Home</a>
  </div>

  <div class="floating-btn batch-nav">
    {% for batch in unique_batches %}
    <a href="#batch{{ batch }}">Batch {{ batch }}</a> {% if not loop.last %}|{% endif %}
    {% endfor %}
    | <a href="#batch5">Batch 5</a>
  </div>

  <!-- Cart Modal -->
  <div id="cartModal" class="cart-modal">
    <div class="cart-modal-content">
      <div id="cartContent"></div>
    </div>
  </div>

  <!-- Dashboard Modal -->
  <div id="dashboardModal" class="dashboard-modal">
    <!-- Dashboard content will be loaded here dynamically -->
  </div>

  <script>
    // Function to open incubatee modal
    function openIncubateeModal(incubateeId) {
      fetch(`/incubates/get-incubatee-details/${incubateeId}`)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const incubatee = data.incubatee;
            const modalContent = document.getElementById('incubateeModalContent');
            
            // Generate modal content based on available data
            modalContent.innerHTML = `
              <div class="incubatee-modal-header">
                  <div class="incubatee-modal-image">
                      ${incubatee.logo_url && incubatee.logo_url.includes('incubatee_logo') 
                          ? `<img src="/static/${incubatee.logo_url}" alt="${incubatee.company_name}">`
                          : `<div class="incubatee-logo-placeholder">
                                <i class="fas fa-building"></i>
                                <span>No Logo Available</span>
                             </div>`
                      }
                  </div>
                <div class="incubatee-modal-info">
                  <h2>${incubatee.company_name}</h2>
                  <p class="incubatee-batch">Batch ${incubatee.batch} ‚Ä¢ Since ${incubatee.year_joined}</p>
                </div>
              </div>
              
              <div class="incubatee-modal-body">
                <div class="incubatee-section">
                  <h3>About</h3>
                </div>
                
                <div class="incubatee-details-grid">
                  <div class="detail-item">
                    <i class="fas fa-user"></i>
                    <div>
                      <strong>Founder/Representative</strong>
                      <p>${incubatee.full_name}</p>
                    </div>
                  </div>
                  
                  <!-- Email -->
                  <div class="detail-item">
                    <i class="fas fa-envelope"></i>
                    <div>
                      <strong>Email</strong>
                      <p>${incubatee.email}</p>
                    </div>
                  </div>
                  
                  <!-- Phone -->
                  <div class="detail-item">
                    <i class="fas fa-phone"></i>
                    <div>
                      <strong>Phone</strong>
                      <p>${incubatee.phone}</p>
                    </div>
                  </div>
                  
                  <!-- Website -->
                  <div class="detail-item">
                    <i class="fas fa-globe"></i>
                    <div>
                      <strong>Website</strong>
                      <p>
                        ${incubatee.website && incubatee.website !== 'No website provided' 
                            ? `<a href="${incubatee.website}" target="_blank">${incubatee.website}</a>`
                            : 'No website available'
                        }
                      </p>
                    </div>
                  </div>
                  
                  <!-- Address -->
                  ${incubatee.contact_info && incubatee.contact_info !== 'No contact information available' ? `
                  <div class="detail-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <div>
                      <strong>Address</strong>
                      <p>${incubatee.contact_info}</p>
                    </div>
                  </div>
                  ` : ''}
                </div>
                
                ${incubatee.products && incubatee.products.length > 0 ? `
                <div class="incubatee-section">
                  <h3>Products & Services (${incubatee.product_count})</h3>
                  <div class="incubatee-products">
                    ${incubatee.products.map(product => `
                      <div class="incubatee-product-item">
                        <div class="product-image">
                          ${product.image_path 
                            ? `<img src="/static/uploads/${product.image_path.replace('uploads/', '').replace('static/', '')}" 
                                alt="${product.name}" 
                                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">`
                            : ''
                          }
                          <div class="product-image-placeholder" style="${product.image_path ? 'display: none;' : ''}">
                            <i class="fas fa-cube"></i>
                            <span>No Image</span>
                          </div>
                        </div>
                        <div class="product-info">
                          <h4>${product.name}</h4>
                          <p class="product-category">${product.category || 'Uncategorized'}</p>
                          <p class="product-description">${product.description}</p>
                          <div class="product-meta">
                            <span class="product-price">‚Ç±${product.price.toFixed(2)}</span>
                            <span class="product-stock">${product.stock} in stock</span>
                          </div>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                </div>
                ` : `
                <div class="incubatee-section">
                  <h3>Products & Services</h3>
                  <p>No products listed yet.</p>
                </div>
                `}
              </div>
            `;
            
            // Show modal
            document.getElementById('incubateeModal').style.display = 'block';
          } else {
            alert('Error loading incubatee details: ' + data.error);
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Error loading incubatee details');
        });
    }

    // Function to close incubatee modal
    function closeIncubateeModal() {
      document.getElementById('incubateeModal').style.display = 'none';
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('incubateeModal');
      if (event.target === modal) {
        closeIncubateeModal();
      }
    }

    // Cart functionality
    async function updateCartCountFromBackend() {
      try {
        const res = await fetch('/cart/count');
        const contentType = res.headers.get('content-type') || '';
        if (!contentType.includes('application/json')) return;

        const data = await res.json();
        if (data.success) {
          const count = data.count || 0;
          const badge = document.getElementById('cartCountBadge');
          if (badge) {
            badge.textContent = count;
            badge.style.display = count > 0 ? 'inline-block' : 'none';
          }
        }
      } catch (err) {
        console.error('Error fetching cart count:', err);
      }
    }

    // Call it on page load
    updateCartCountFromBackend();

    // Optional: auto-update every 10-15 seconds
    setInterval(updateCartCountFromBackend, 15000);
  </script>

  <!-- Add CSS for logo placeholders -->
  <style>
    .incubate-image-placeholder {
      width: 100%;
      height: 200px;
      background: #f8f9fa;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #6c757d;
    }
    
    .incubate-image-placeholder i {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    
    .incubatee-logo-placeholder {
      width: 120px;
      height: 120px;
      background: #f8f9fa;
      border: 2px dashed #dee2e6;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      text-align: center;
    }
    
    .incubatee-logo-placeholder i {
      font-size: 2rem;
      margin-bottom: 8px;
    }
    
    .incubate-website {
      margin: 8px 0;
    }
    
    .incubate-website a {
      color: #007bff;
      text-decoration: none;
    }
    
    .incubate-website a:hover {
      text-decoration: underline;
    }
  </style>

  <script src="{{ url_for('static', filename='js/cart.js') }}"></script>
  <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>