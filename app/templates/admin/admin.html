<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
  <title>Admin - Incubatee Management</title>
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='images/agrilogo.png') }}">
</head>
<body>
  <!-- üåø Header with Logout and Add Incubatee -->
  <div class="header">
    <h1>üè¢ ATBI Admin Dashboard</h1>
      <div class="header-actions">
          <!-- Management Sections (Keep as pages if needed) -->
          <a href="{{ url_for('admin.users_management') }}" class="users-btn">
              <span class="icon">üë•</span> Users
          </a>
          <a href="{{ url_for('admin.incubatees_management') }}" class="incubatees-btn">
              <span class="icon">üè¢</span> Incubatees
          </a>
          
          <!-- Reports & Analytics -->
          <a href="{{ url_for('admin.sales_reports') }}" class="reports-btn">
              <span class="icon">üìä</span> Incubatee Reports
          </a>
          <button class="sales-report-btn" id="openSalesReportModal">
              <span class="icon">üìà</span> Sales Report
          </button>
          
          <!-- Operations -->
          <button class="view-orders-btn" id="openOrdersModal">
              <span class="icon">üìã</span> View Orders
          </button>
          
          <!-- User & System -->
          <a href="{{ url_for('admin.admin_profile') }}" class="profile-btn">
              <span class="icon">üë§</span> Profile
          </a>
          <button class="logout-btn" onclick="logout()">üö™ Logout</button>
      </div>
  </div>

  <!-- Orders Modal -->
  <div id="ordersModal" class="modal">
    <div class="modal-content large-modal">
      <div class="modal-header">
        <h2>üìã Order Reservations</h2>
        <button class="close-btn" id="closeOrdersModalTop">&times;</button>
      </div>
      
      <div class="filter-bar">
        <label for="orderStatusFilter">Filter by Status:</label>
        <select id="orderStatusFilter" class="filter-select">
          <option value="all">All Orders</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="completed">Completed</option>
          <option value="rejected">Rejected</option>
        </select>
      </div>

      <div class="orders-container">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>User ID</th>
              <th>Product</th>
              <th>Quantity</th>
              <th>Price</th>
              <th>Total</th>
              <th>Status</th>
              <th>Reserved Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="orders-list">
            <!-- Orders will be populated here -->
          </tbody>
        </table>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" id="closeOrdersModalBottom">Close</button>
      </div>
    </div>
  </div>
  <!-- Sales Report Modal -->
  <div id="salesReportModal" class="modal">
    <div class="modal-content large-modal">
      <div class="modal-header">
        <h2>üìä Sales Report</h2>
        <button class="close-btn" id="closeSalesReportModalTop">&times;</button>
      </div>
      
      <div class="filter-bar">
        <label for="reportDate">Select Date:</label>
        <input type="date" id="reportDate" class="filter-select" value="{{ formattedDate }}">
        <button class="btn-generate" onclick="generateSalesReport()">Generate Report</button>
        <button class="btn-export" onclick="exportSalesReport()">Export to CSV</button>
      </div>

      <div class="sales-summary">
        <div class="summary-cards">
          <div class="summary-card">
            <div class="summary-value" id="totalSales">‚Ç±0.00</div>
            <div class="summary-label">Total Sales</div>
          </div>
          <div class="summary-card">
            <div class="summary-value" id="totalOrders">0</div>
            <div class="summary-label">Total Orders</div>
          </div>
          <div class="summary-card">
            <div class="summary-value" id="completedOrders">0</div>
            <div class="summary-label">Completed Orders</div>
          </div>
          <div class="summary-card">
            <div class="summary-value" id="totalProducts">0</div>
            <div class="summary-label">Products Sold</div>
          </div>
        </div>
      </div>

      <div class="orders-container">
        <table class="orders-table">
          <thead>
            <tr>
              <th>Order ID</th>
              <th>User ID</th>
              <th>Product</th>
              <th>Quantity</th>
              <th>Unit Price</th>
              <th>Total Price</th>
              <th>Status</th>
              <th>Reserved Date</th>
              <th>Completed Date</th>
            </tr>
          </thead>
          <tbody id="sales-report-list">
            <!-- Sales report data will be populated here -->
          </tbody>
        </table>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn-cancel" id="closeSalesReportModalBottom">Close</button>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- LEFT: Entry Form -->
    <div class="card-incubatee">
      <h2>Add Incubatee Product</h2>
      <div class="date-display">Date: <span id="current-date"></span></div>

      <form id="incubateeForm">
        <div class="form-group">
          <label for="category">Category</label>
          <select id="category" name="category" class="form-control" required>
            <option value="" disabled selected>Select Category</option>
            <option value="Agri-Aqua Business">Agri-Aqua Business</option>
            <option value="Food Processing Technology">Food Processing Technology</option>
          </select>
        </div>
        <div class="form-group incubatee-search-container">
          <label for="incubateeSearch">Incubatee Name</label>
          <div class="incubatee-search-container">
            <input type="text" id="incubateeSearch" placeholder="Search incubatee..." autocomplete="off">
            <div id="incubateeDropdown" class="dropdown hidden"></div>
          </div>
          <input type="hidden" id="incubatee_id" name="incubatee_id" required>
        </div>

        <div class="form-group">
          <label for="name">Product Name <span class="required-star">*</span></label>
          <input type="text" id="name" name="name" placeholder="Enter incubatee name" required>
        </div>
        <div class="form-group">
          <label for="stock_no">Stock Number <span class="required-star">*</span></label>
          <input type="text" id="stock_no" name="stock_no" placeholder="Only numbers and dash (-)" required>
        </div>
        <div class="form-group">
          <label for="products">Offered Services <span class="required-star">*</span></label>
          <input type="text" id="products" name="products" placeholder="Letters only" required>
        </div>
        <div class="form-group">
          <label for="stock_amount">Stock Amount <span class="required-star">*</span></label>
          <input type="number" id="stock_amount" name="stock_amount" placeholder="Enter stock amount" required>
        </div>
        <div class="form-group">
          <label for="price_per_stocks">Price per Stock (‚Ç±) <span class="required-star">*</span></label>
          <input type="number" step="0.01" id="price_per_stocks" name="price_per_stocks" placeholder="Enter price" required>
        </div>
        <!-- Add this form group after the price_per_stocks field -->
        <div class="form-group">
          <label for="pricing_unit">Pricing Unit <span class="required-star">*</span></label>
          <div class="pricing-unit-search-container">
            <input type="text" id="pricing_unit_search" placeholder="Search pricing unit..." autocomplete="off">
            <div id="pricingUnitDropdown" class="dropdown hidden"></div>
          </div>
          <input type="hidden" id="pricing_unit" name="pricing_unit_id" required>
          <button type="button" class="btn-add-unit" id="addPricingUnitBtn" style="margin-top: 5px; padding: 5px 10px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
            + Add New Pricing Unit
          </button>
        </div>
        <div class="form-group">
          <label for="details">Product Description <span class="required-star">*</span></label>
          <textarea id="details" name="details" rows="3" placeholder="Enter product details" required></textarea>
        </div>
                <!-- New Image Upload -->
        <div class="form-group">
          <label for="product_image">Product Image <span class="required-star">*</span></label>
          <input type="file"  id="product_image"  name="product_image"  accept="image/*" required>
          <!-- Preview -->
          <div id="image-preview" style="margin-top:10px;">
            <img id="preview-img" src="" alt="Preview" style="max-width:150px; display:none; border:1px solid #ccc; padding:5px; border-radius:6px;">
          </div>
        </div>
        <div class="form-group">
          <label for="expiration_date">Expiration Date <span class="required-star">Optional</span></label>
          <input type="date" id="expiration_date" name="expiration_date">
        </div>
        <div class="form-group">
          <label for="warranty">Warranty (Optional)</label>
          <input type="text" id="warranty" name="warranty" placeholder="e.g., 6 months, 1 year, or none">
        </div>
        <button type="submit" class="btn">Save Product</button>
      </form>
    </div>

  <!-- RIGHT: Product List -->
  <div class="card">
    <div class="filter-bar">
      <label for="categoryFilter">Filter by Category:</label>
      <select id="categoryFilter" class="filter-select">
        <option value="all" selected>All Categories</option>
        <option value="Agri-Aqua Business">Agri-Aqua Business</option>
        <option value="Food Processing Technology">Food Processing Technology</option>
      </select>
    </div>

    <h2>Incubatee Product List</h2>
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>Incubatee</th>
            <th>Stock No</th>
            <th>Product Name</th>
            <th>Stock</th>
            <th>Price</th>
            <th>Unit</th>
            <th>Image</th>
            <th>Expiration</th>
            <th>Warranty</th>
            <th>Date Added</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="product-list">
          <!-- Products will be populated here by JavaScript -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Floating Logout Confirmation -->
  <div id="logout-modal" class="logout-modal hidden">
    <div class="logout-content">
      <p>üö™ Are you sure you want to logout?</p>
      <div class="logout-actions">
        <button id="confirm-logout">Yes, Logout</button>
        <button id="cancel-logout">Cancel</button>
      </div>
    </div>
  </div>
  
  <!-- Edit Product Modal -->
  <div id="editProductModal" class="editproduct-modal">
    <div class="editproduct-modal-content large-modal">
      <div class="editproduct-modal-header">
        <h2>‚úèÔ∏è Edit Product</h2>
        <button class="close-btn" id="closeEditProductModalTop">&times;</button>
      </div>
      
      <form id="editProductForm" enctype="multipart/form-data">
        <input type="hidden" id="edit_product_id" name="product_id">
        
        <div class="form-group">
          <label for="edit_name">Product Name <span class="required-star">*</span></label>
          <input type="text" id="edit_name" name="name" placeholder="Enter product name" required>
        </div>

        <div class="form-group">
          <label for="edit_stock_no">Stock Number <span class="required-star">*</span></label>
          <input type="text" id="edit_stock_no" name="stock_no" placeholder="Only numbers and dash (-)" required>
        </div>

        <div class="form-group">
          <label for="edit_products">Offered Services <span class="required-star">*</span></label>
          <input type="text" id="edit_products" name="products" placeholder="Letters only" required>
        </div>

        <div class="form-group">
          <label for="edit_stock_amount">Stock Amount <span class="required-star">*</span></label>
          <input type="number" id="edit_stock_amount" name="stock_amount" placeholder="Enter stock amount" required>
        </div>

        <div class="form-group">
          <label for="edit_price_per_stocks">Price per Stock (‚Ç±) <span class="required-star">*</span></label>
          <input type="number" step="0.01" id="edit_price_per_stocks" name="price_per_stocks" placeholder="Enter price" required>
        </div>

        <div class="form-group">
          <label for="edit_pricing_unit">Pricing Unit <span class="required-star">*</span></label>
          <select id="edit_pricing_unit" name="pricing_unit_id" class="form-control" required>
            <option value="">Select Pricing Unit</option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit_details">Product Description <span class="required-star">*</span></label>
          <textarea id="edit_details" name="details" rows="3" placeholder="Enter product details" required></textarea>
        </div>

        <div class="form-group">
          <label for="edit_category">Category <span class="required-star">*</span></label>
          <select id="edit_category" name="category" class="form-control" required>
            <option value="">Select Category</option>
            <option value="Agri-Aqua Business">Agri-Aqua Business</option>
            <option value="Food Processing Technology">Food Processing Technology</option>
          </select>
        </div>

        <div class="form-group">
          <label for="edit_product_image">Product Image</label>
          <input type="file" id="edit_product_image" name="product_image" accept="image/*">
          <div id="edit_image_preview" style="margin-top:10px;">
            <img id="edit_preview_img" src="" alt="Preview" style="max-width:150px; display:none; border:1px solid #ccc; padding:5px; border-radius:6px;">
            <div id="edit_current_image" style="margin-top: 5px;"></div>
          </div>
        </div>

        <div class="form-group">
          <label for="edit_expiration_date">Expiration Date</label>
          <input type="date" id="edit_expiration_date" name="expiration_date">
        </div>

        <div class="form-group">
          <label for="edit_warranty">Warranty</label>
          <input type="text" id="edit_warranty" name="warranty" placeholder="e.g., 6 months, 1 year, or none">
        </div>

        <div class="editproduct-modal-actions">
          <button type="button" class="btn-cancel" id="closeEditProductModalBottom">Cancel</button>
          <button type="submit" class="btn-save">Update Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Pricing Unit Modal -->
  <div id="pricingUnitModal" class="add-pricing-modal">
      <div class="modal-content">
          <div class="modal-header">
              <h2>Add New Pricing Unit</h2>
              <button class="close-btn" id="closePricingUnitModal">&times;</button>
          </div>
          
          <form id="pricingUnitForm">
              <div class="form-group">
                  <label for="unit_name">Unit Name <span class="required-star">*</span></label>
                  <input type="text" id="unit_name" name="unit_name" placeholder="e.g., Per Kilo, Per Item, Per Package" required>
              </div>
              
              <div class="form-group">
                  <label for="unit_description">Description (Optional)</label>
                  <textarea id="unit_description" name="unit_description" rows="3" placeholder="Brief description of the unit"></textarea>
              </div>
              
              <div class="modal-actions">
                  <button type="button" class="btn-cancel" id="closePricingUnitModalBottom">Cancel</button>
                  <button type="submit" class="btn-save">Save Unit</button>
              </div>
          </form>
      </div>
  </div>
  <!-- Include the external JavaScript file -->
  <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>